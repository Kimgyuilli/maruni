# AI 대화 기능 요구사항 분석

## 📋 프로젝트 개요

MARUNI 노인 돌봄 플랫폼의 핵심 기능인 AI 기반 대화 시스템을 구현한다. 사용자(노인)가 SMS로 전송한 메시지에 대해 AI가 적절한 응답을 생성하여 SMS로 회신하는 기능이다.

## 🎯 비즈니스 요구사항

### 1. 핵심 목표
- **노인 대상 말벗 서비스**: 외로움 해소 및 정서적 지원
- **자연스러운 대화**: 이전 대화 맥락을 기억하는 연속적 대화
- **적절한 응답 톤**: 노인분께 적합한 존댓말과 따뜻한 말투
- **안전한 대화**: 부적절한 내용 필터링 및 안전 장치

### 2. 사용자 시나리오

#### 시나리오 1: 첫 대화
```
👵 사용자: "안녕하세요"
🤖 AI: "안녕하세요! 반갑습니다. 오늘 기분은 어떠세요?"
```

#### 시나리오 2: 감정 표현
```
👵 사용자: "오늘 좀 우울해요"
🤖 AI: "그런 날이 있으시군요. 무엇 때문에 우울하신지 말씀해주시겠어요? 제가 들어드릴게요."
```

#### 시나리오 3: 일상 대화
```
👵 사용자: "오늘 산책을 다녀왔어요"
🤖 AI: "와, 산책을 다녀오셨군요! 날씨도 좋았겠어요. 어디로 산책을 다녀오셨나요?"
```

#### 시나리오 4: 맥락 기억
```
👵 사용자: "어제 말했던 병원 다녀왔어요"
🤖 AI: "아, 어제 말씀하신 정기검진 받으러 가셨군요! 검사 결과는 어떻게 나왔나요?"
```

## 🔧 기능 요구사항

### 1. 핵심 기능

#### F1. 메시지 수신 및 처리
- **입력**: 사용자 SMS 메시지
- **처리**: 메시지 내용 분석 및 저장
- **출력**: 처리 완료 상태

#### F2. AI 응답 생성
- **입력**: 사용자 메시지 + 대화 맥락
- **처리**: OpenAI GPT API 호출
- **출력**: 자연스러운 한국어 응답

#### F3. 대화 이력 관리
- **저장**: 사용자/AI 메시지 모두 저장
- **조회**: 최근 N개 메시지 맥락 구성
- **관리**: 오래된 대화 정리 및 요약

#### F4. SMS 응답 발송
- **연동**: 기존 SMS 발송 시스템 활용
- **타입**: SmsType.AI_RESPONSE
- **추적**: 발송 이력 및 성공/실패 관리

### 2. 부가 기능

#### F5. 감정 상태 분석 (향후 확장)
- 사용자 메시지에서 감정 상태 파악
- 우울, 불안 등 이상 징후 감지
- 필요시 보호자 알림 연동

#### F6. 대화 품질 관리
- 응답 길이 제한 (SMS 특성상)
- 부적절한 내용 필터링
- API 토큰 사용량 관리

## 📊 비기능 요구사항

### 1. 성능 요구사항
- **응답 시간**: 5초 이내 AI 응답 생성
- **처리량**: 동시 100명 사용자 지원
- **가용성**: 99.5% 가동률 목표

### 2. 보안 요구사항
- **데이터 암호화**: 대화 내용 DB 저장시 암호화
- **API 키 관리**: OpenAI API 키 안전한 저장
- **개인정보 보호**: 민감 정보 로깅 제한

### 3. 운영 요구사항
- **모니터링**: API 호출 성공률 및 응답 품질 추적
- **로깅**: 에러 상황 및 예외 케이스 기록
- **백업**: 대화 이력 정기 백업

## 🏗️ 기술 요구사항

### 1. AI/ML 요구사항
- **OpenAI GPT API**: gpt-3.5-turbo 또는 gpt-4 사용
- **프롬프트 엔지니어링**: 노인 대상 맞춤형 시스템 프롬프트
- **토큰 관리**: 비용 효율적인 API 사용

### 2. 데이터 모델
- **Conversation**: 회원별 대화방
- **Message**: 개별 메시지 (사용자/AI)
- **ConversationContext**: 대화 맥락 정보

### 3. 시스템 연동
- **SMS 시스템**: 기존 SmsService와 연동
- **회원 시스템**: MemberEntity와 연동
- **알림 시스템**: 향후 보호자 알림 연동

## 🚫 제약사항 및 가정

### 1. 제약사항
- **SMS 길이 제한**: 한글 기준 90자 (270byte) 이내
- **API 비용**: 월 $100 이내 사용
- **응답 지연**: 외부 API 의존으로 인한 지연 가능성

### 2. 가정
- **사용자 특성**: 60세 이상 노인층 대상
- **사용 패턴**: 1일 평균 3-5회 대화
- **네트워크**: SMS 수신/발송 안정적 동작

## 📈 성공 지표

### 1. 정량적 지표
- **응답률**: 95% 이상 성공적 AI 응답 생성
- **응답 시간**: 평균 3초 이내
- **사용자 만족도**: 설문조사 4점/5점 이상

### 2. 정성적 지표
- **대화 자연스러움**: 맥락을 이해하는 연속적 대화
- **감정적 지원**: 사용자의 정서적 만족도
- **기술적 안정성**: 시스템 오류 최소화

## 🔄 향후 확장 계획

### 1. 단기 (3개월)
- 감정 상태 분석 및 이상 징후 감지
- 대화 요약 및 리포트 생성
- 보호자 알림 연동

### 2. 중장기 (6-12개월)
- 음성 메시지 지원
- 다국어 지원
- 개인화된 대화 스타일 학습

---

*이 문서는 AI 대화 기능의 요구사항을 정의하며, 구현 과정에서 지속적으로 업데이트됩니다.*